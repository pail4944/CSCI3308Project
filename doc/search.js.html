<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: search.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: search.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>
/**
 * Grabs keys from firebase database and stores keys. Calls getsearch when keys are received.
 *@example 
 *getkeys('denver', 'food', false)
 *@param {string} city - city to be searched on Yelp
 *@param {string} term - term to be searched on Yelp 
 *@param {boolean} test - determines whether we search or not
 */
function getkeys(city, term, test){
    var DB = new Firebase('luminous-heat-9947.firebaseIO.com');
    DB.on("value", function (snapshot){
        key_data = snapshot.val()
        $('#keys').data(key_data)
        if (!test){
            console.log("getting search")
            getsearch(key_data, city, term)
        }
    })  
}

/**
 * Queries Yelp API with 4 keys from getkeys.
 * Once gotten, writes out all businesses in results element and calls createmap
 *@example
 *getsearch(Object, 'denver', 'food')
 *@param {Object} key_data - 4 authetication keys needed to access Yelp API
 *@param {string} city - city to be searched on Yelp
 *@param {string} term - term to be searched on Yelp 
 */
function getsearch(key_data, city, term){
    var auth = {
        consumerKey : key_data.key.ConsKey,
        consumerSecret : key_data.key.ConsSecret,
        accessToken : key_data.key.AccessToken,
        accessTokenSecret : key_data.key.AccessSecret,
        serviceProvider : {
            signatureMethod : "HMAC-SHA1"
        }
    }

    var terms = term
    var near = city

    var accessor = {
        consumerSecret : auth.consumerSecret,
        tokenSecret : auth.accessTokenSecret
    }

    parameters = [];
    parameters.push(['term', terms]);
    parameters.push(['location', near]);
    parameters.push(['callback', 'cb']);
    parameters.push(['oauth_consumer_key', auth.consumerKey]);
    parameters.push(['oauth_consumer_secret', auth.consumerSecret]);
    parameters.push(['oauth_token', auth.accessToken]);
    parameters.push(['oauth_signature_method', 'HMAC-SHA1']);

    var message = {
        'action' : 'http://api.yelp.com/v2/search',
        'method' : 'GET',
        'parameters' : parameters
    };

    OAuth.setTimestampAndNonce(message);
    OAuth.SignatureMethod.sign(message, accessor);

    var parameterMap = OAuth.getParameterMap(message.parameters);
    console.log()
    $.ajax({
        'url' : message.action,
        'data' : parameterMap,
        'dataType' : 'jsonp',
        'jsonpCallback' : 'cb',
        'success' : function(data, textStats, XMLHttpRequest) {
            $('#confirm').text("It worked!" + " Searched for " + $('#city').val() + "  " + $('#term').val())
            var str = "Results: " + "&lt;br>"
            _.forEach(data.businesses, function(d){  
                str += ("Name: " + d.name + "&lt;br>" + "Address: " + d.location.address + "&lt;br>" + "Rating: " + getstar(d.rating) + "&lt;br>&lt;br>&lt;br>") 
            })
            document.getElementById("results").innerHTML = str
            document.getElementById("yelplogo").src = "assets/yelp-logo-large.png"
            console.log(data)
            var map = createmap('map', [data.region.center.latitude, data.region.center.longitude], 12, data)
            $('#search').click(function(){
                map.remove()
            })
        }
    })
}</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#createmap">createmap</a></li><li><a href="global.html#getkeys">getkeys</a></li><li><a href="global.html#getsearch">getsearch</a></li><li><a href="global.html#getstar">getstar</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.0</a> on Mon Apr 25 2016 00:35:23 GMT-0600 (MDT)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
